<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="li.rajenlab.canto.core.domain.booking">

  <class name="Booking" table="BOOKING">
  	
 	<id name="id" column="ID" type="long">
      <generator class="native"/>
    </id>
    <version column="VERSION" name="version"/>
    <property name="creationTime" type="timestamp">
      <column name="CREATION_TIME"/>
    </property>
    <property name="changeTime" type="timestamp">
      <column name="CHANGE_TIME"/>
    </property>
    
      <!-- Property mapping -->
    <property name="bookingNr" length="17">
       <column name="BOOKING_NR" unique="true" not-null="true"/>
    </property>
     <property name="startDate" type="timestamp">
      <column name="START_DATE"/>
    </property>
    <property name="endDate" type="timestamp">
      <column name="endDate"/>
    </property>
	<property name="status">
       <column name="STATUS" not-null="true"/>
       <type name="li.rajenlab.common.hibernate.type.StringValuedEnumType">
         <param name="enumClass">li.rajenlab.canto.core.domain.booking.BookingStatus</param>
       </type>
    </property>
    <property name="paymentType">
       <column name="PAYMENT_TYPE" not-null="true"/>
       <type name="li.rajenlab.common.hibernate.type.StringValuedEnumType">
         <param name="enumClass">li.rajenlab.canto.core.domain.payment.PaymentType</param>
       </type>
    </property>
    
    <!-- Association mapping -->
    <many-to-one name="createdBy"   column="CREATED_BY" not-null="true"/>
    <many-to-one name="lastModifiedBy" column="LAST_MODIFIED_BY"/>
    <many-to-one name="orderChannel"   column="ORDER_CHANNEL_ID" not-null="true"/>
    <many-to-one name="customer" column="CUSTOMER_ID" not-null="true"/>
 
    
    <set name="items" table="BOOKING_ITEMS">
      <key column="BOOKING_ID"/>
      <composite-element class="li.rajenlab.canto.core.domain.booking.BookingItem">
        <property name="quantity" type="float" not-null="true">
        	<column name="QUANTITY"/>
        </property>
        <property name="price" type="float" not-null="true">
           <column name="PRICE"/>
        </property>
        <many-to-one name="product" column="PRODUCT_ID"/>
    	</composite-element>
    </set>
    
    <set name="notes" table="BOOKING_NOTES" order-by="NOTE_DATE DESC">
      <key column="BOOKING_ID"/>
      <composite-element class="li.rajenlab.canto.core.domain.common.Note">
        <property name="message" length="2000">
           <column name="MESSAGE"/>
        </property>
        <property name="noteDate" type="timestamp">
        	<column name="NOTE_DATE"/>
        </property>
        <many-to-one name="user" column="USER_ID"/>
    	</composite-element>
    </set>

  </class>
    
</hibernate-mapping>  